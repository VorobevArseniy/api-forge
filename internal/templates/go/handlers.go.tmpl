// Code generated by api-generator. DO NOT EDIT.
package api

import (
    "net/http"
    "encoding/json"
)

{{ range $svcName, $svc := .Services }}
    // {{ $svcName }}Handler - обработчик HTTP-запросов для {{ $svcName }}
    type {{ $svcName }}Handler struct {
        svc {{ $svcName }}Service
    }

    {{ range $epName, $ep := $svc.Endpoints }}
        // {{ $epName }} - обработчик {{ $ep.Method }} {{ $ep.Path }}
        func (h *{{ $svcName }}Handler) {{ $epName }}(w http.ResponseWriter, r *http.Request) {
            var req models.{{ $epName }}Request
            if err := json.NewDecoder(r.Body).Decode(&req); err != nil {
                http.Error(w, "Invalid JSON", http.StatusBadRequest)
                return
            }

            {{ if $ep.Query }}
            // Парсинг query-параметров
            query := r.URL.Query()
            {{ range $param, $type := $ep.Query }}
            if q := query.Get("{{ $param }}"); q != "" {
                req.{{ $param | ToCamel }} = {{ if eq $type "string" }}q{{ else }}parse{{ $type | ToTitle }}(q){{ end }}
            }
            {{ end }}
            {{ end }}

            resp, err := h.svc.{{ $epName }}(r.Context(), &req)
            if err != nil {
                http.Error(w, err.Error(), http.StatusInternalServerError)
                return
            }

            w.Header().Set("Content-Type", "application/json")
            json.NewEncoder(w).Encode(resp)
        }
    {{ end }}
{{ end }}
